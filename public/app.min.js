(function(){function g(){h.list(function(a){$("li.loading").remove();for(id in a){var b=a[id];b.do_on===i.toString()&&f(b)}})}function f(a){var b=$("li.placeholder").first().removeClass("placeholder");b.length===0&&(b=$('<li><p></p> <span class="delete"><a href="">x</a></span></li>'),$("div.list ul").append(b)),b.find("p").text(a.todo),b.attr("data-id",a.id),a.done&&b.addClass("crossedout")}function e(a){a=a||new Date;return["December","January","February","March","April","May","June","July","August","September","October","November"][a.getMonth()]}function d(a){a=a||new Date;return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()]}function c(){var a=new Date;a.toString=function(){return b(a)},a.getRealYear=function(){return a.getYear()+1900};return a}function b(b){b=b||new Date;return b.getYear()+1900+"-"+a(b.getMonth()+1,2,0)+"-"+a(b.getDate(),2,0)}var a=function(a,b,c,d){c=Array((b=(b||0)-(""+a).length+1)>0&&b||0).join(c!=d?c:" ");return{l:c+a,r:a+c,toString:function(){return c+a}}},h=function(){function c(a,b,c,d){var e=b.dataType||"json";delete b.dataType,$.ajax({url:a,type:"POST",data:b,dataType:e,success:c,error:d})}function a(a,b,c){$.ajax({url:a,success:b,error:c,dataType:"json"})}return{user:function(b,c){a("/teuxdeux/user.json",b,c)},create:function(a,d,e,f,g,h){typeof e=="function"&&(g=e,e=!1,typeof f=="function"&&(h=f,f=0)),c("/teuxdeux/todo.json",{todo_item:{todo:a,do_on:d||b(),done:e?1:0,position:f||0}},g,h)},remove:function(a,b,d){c("/teuxdeux/todo/"+a,{_method:"delete",dataType:"text"},b,d)},list:function(b,c){a("/teuxdeux/list.json",b,c)},toggle:function(a,b,d,e){var f={todo_item:{}};f.todo_item[a]={done:b?1:0},c("/teuxdeux/update.json",f,d,e)}}}();$(".date").swipeLeft(function(){console.log("date switch not implemented")}).swipeRight(function(){console.log("date switch not implemented")}),$("form.new_todo").bind("submit",function(a){a.preventDefault();var b=$(a.target).find("input.entry"),c=b.val();c&&c.length>0&&h.create(c,$(a.target).find("input.item_date").val(),function(a){b.val(""),f(a)})}),$("li").live("click",function(a){if(a.target.nodeName!="A"){a.preventDefault();var b=$(a.target);a.target.nodeName=="P"&&(b=b.parent()),b.hasClass("placeholder")||h.toggle(b.attr("data-id"),b.hasClass("crossedout")?!1:!0,function(){b.toggleClass("crossedout")})}}),$("li.crossedout span.delete a").live("click",function(a){a.preventDefault();var b=$(a.target).parent().parent(),c=b.attr("data-id");h.remove(c,function(){b.remove(),$("div.list ul li").length<12&&(obj=$('<li class="placeholder"><p></p> <span class="delete"><a href="">x</a></span></li>'),$("div.list ul").append(obj))})});var i=c();$(document).ready(function(){$("div.today h1 span").text(d(i)),$("div.today h3").text(e(i)+" "+i.getDate()+", "+i.getRealYear()),$("input.item_date").val(i.toString()),/mobile/i.test(navigator.userAgent)&&!location.hash&&setTimeout(function(){window.scrollTo(0,1)},1e3),h.user(function(a){g()},function(a,b){console.log(a,b)})})})()